<?xml version="1.0" encoding="utf-8"?>

<chapter
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  lang="en"
  version="5.0"
  xml:id="sec_3_3">

  <title>The <guilabel>Flow editor</guilabel> tab</title>

  <para>To create a Flow, the user can follow the instructions of
    <xref linkend="flows_browser_create_flow" />.</para>

  <tip>
    <para>Instead of buttons from the toolbar, try
      using <emphasis role="bold">context menus</emphasis>. To do
      so, <emphasis role="bold">right-click</emphasis> on a program
      that has been already added. The user can notice that many commands can be accessed through
      this menu. For certain cases, this method is easier and
      faster than using command buttons.</para>
  </tip>

  <section xml:id="flow_editor_create_flow">
    <title>Assembling the Flow</title>
    <para>In GêBR, a <emphasis>Flow</emphasis> is a <emphasis>sequence
      of operations</emphasis> defined by the user. These operations, also
      called
      Flow's <emphasis>programs</emphasis><indexterm><primary>Program</primary></indexterm>,
      are organized into the following <emphasis>categories</emphasis>
      according to their purpose:</para>
    <itemizedlist>
      <listitem>
        <para>Data Compression</para>
      </listitem>
      <listitem>
        <para>Editing, Sorting and Manipulation</para>
      </listitem>
      <listitem>
        <para>File tools</para>
      </listitem>
      <listitem>
        <para>Filtering, Transforms and Attributes</para>
      </listitem>
      <listitem>
        <para>Gain, NMO, Stack and Standard Processes</para>
      </listitem>
      <listitem>
        <para>Graphics</para>
      </listitem>
      <listitem>
        <para>Import/Export</para>
      </listitem>
      <listitem>
        <para>Migration and Dip Moveout</para>
      </listitem>
      <listitem>
        <para>Multiple Supression</para>
      </listitem>
      <listitem>
        <para>Seismic Unix</para>
      </listitem>
      <listitem>
        <para>Simulation and Model Building</para>
      </listitem>
      <listitem>
        <para>Utilities</para>
      </listitem>
    </itemizedlist>

    <para>To create a Flow, the user must select and order programs from the
      above categories. Now, the user can see how this is done:</para>
    <procedure>
      <step>
        <para>In the tab <guilabel>Projects and Lines</guilabel>,
          check that a Line has been selected.</para>
      </step>
      <step>
        <para>Now click on the tab 
          <guilabel>Flows</guilabel>, then left-click on 
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_criar_fluxo.png" />
              </imageobject>
            </inlinemediaobject>
        </guiicon>.</para>
      </step>
      <step>
        <para>The dialog box <guilabel>Flow "New Flow"
            Properties</guilabel> will appear. The user must fill in
          a <emphasis>title</emphasis> for this Flow (for
          example, <userinput>My First Flow</userinput>). The user can
          also give a brief <emphasis>description</emphasis> of the
          Flow, the <emphasis>author</emphasis> and
          an <emphasis>e-mail</emphasis> for contact. If the user is
          done filling in this Flows properties click
          on <guibutton>OK</guibutton>.</para>
      </step>
      <step>
        <para>Now the user has to select the tab <guilabel>Flow Editor</guilabel>. On
          the right side a list with several menus will be shown .
          Choose one of them and include it in the Flow with a
          double-click.
        </para>
      </step>
      <step>
        <para>If the user needs a specific order to the selected programs
          of the flow, he or she just needs to drag and drop the desired
          programs.
        </para>
        <figure>
          <title>Flow editor tab</title>
          <mediaobject>
            <caption>In the Flow Editor tab, the user will see 
            the Menus<indexterm><primary>Menu</primary></indexterm>
              bo, on the right side of the main window.
               From this box the user can add programs to the Flow,
              which will appear in the Flow sequence box on the left
              side of the main window.</caption>
            <imageobject>
              <imagedata fileref="../images/GeBR_flow_browser_flow_assembling.png" />
            </imageobject>
          </mediaobject>
        </figure>
      </step>
      <step>
        <para>To enable a program of the Flow, the user has to
          right-click over it and select
          the <emphasis>Configured</emphasis> option. The icon will
          change from
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/icone_nao_configurado.png" />
              </imageobject>
            </inlinemediaobject>
          </guiicon>
          to
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/icone_configurado.png" />
              </imageobject>
            </inlinemediaobject>
        </guiicon>.</para>
        <figure>
          <title>Program configurations</title>
          <mediaobject>
            <caption>To enable a program, select the Configured
            option.</caption>
            <imageobject>
              <imagedata fileref="../images/GeBR_flow_browser_flow_assembling_02.png" />
            </imageobject>
          </mediaobject>
        </figure>
        <tip>
          <para>If the user wants to change all programs, or a few, to the
            configured state simultaneously, he or she can select them by using
            <keycombo>
              <keycap>Ctrl</keycap>
              <mousebutton>Click</mousebutton>
            </keycombo>. Then right-click on one of the selected
            programs, choose the
            option <guilabel>Configured</guilabel> from the menu that
            appeared. All the programs that were selected will be
            altered to the state
            <guiicon>
              <inlinemediaobject>
                <imageobject>
                  <imagedata fileref="../../common-images/icone_configurado.png" />
                </imageobject>
              </inlinemediaobject>
          </guiicon>.</para>
        </tip>
        <important>
          <para>To run a Flow 
            <emphasis role="bold">all the programs</emphasis> listed in the 
            <guilabel>Flow Sequence</guilabel> box must be 
            <guilabel>Configured</guilabel> (<guiicon>
              <inlinemediaobject>
                <imageobject>
                  <imagedata fileref="../../common-images/icone_configurado.png" />
                </imageobject>
              </inlinemediaobject>
          </guiicon>). Otherwise the Flow will not be executed as
          expected.</para>
        </important>
        <important>
          <para>The state of a Flow, or a set of Flows, can be changed
            by using the
            hotkey <emphasis role="bold">Spacebar</emphasis>, which
            alters the state of the selected programs in the order
            <emphasis role="bold">Not configured</emphasis>, 
            <emphasis role="bold">Disabled</emphasis> and 
            <emphasis role="bold">Configured</emphasis>. The meaning
            of these states will be further described later on.</para>
        </important>
      </step>
    </procedure>
    <para>The Flow is ready to be executed. Click on 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_executar_fluxo.png" />
          </imageobject>
        </inlinemediaobject>
    </guiicon> to do it.</para>
    <para>After the Flow has been, it will be visible on the left
      side of the main window when the <guilabel>Flows</guilabel> tab
      is selected. The <guilabel>Details</guilabel> box, found on the
      right side of the main window, shows information about the selected
      Flow .</para>
    <tip>There is 
      no limit on the number of Flows that can be created inside a Line.</tip>
    <tip>
      <para>The user can alter 
        <emphasis role="bold">the position</emphasis> of the Flow in
        the list by <emphasis role="bold">dragging the Flow with the
          mouse</emphasis> to the desired position.</para>
    </tip>
    <tip>
      <para>The <emphasis role="bold">information bar</emphasis> just bellow
        the menu <guimenu>Actions</guimenu> shows the complete Flow
        tree of the selected Flow.</para>
    </tip>
  </section>


  <section xml:id="flow_editor_copy_program">
    <title>Copying, pasting and deleting programs</title>
    <para>In the same manner the user can copy and paste Flows (see
      <xref linkend="flows_browser_copy_paste_del_flows" />), a
      program (or set of programs) can be copied to the clipboard by
      clicking
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_copiar_fluxo.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon> or by using the shortcut 
      <keycombo>
        <keycap>Ctrl</keycap>
        <keycap>C</keycap>
    </keycombo>.</para>

    <para>To remove a program (or set of programs), select them and
      click on
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_apagar_projeto.png" />
          </imageobject>
        </inlinemediaobject>
    </guiicon>.</para>

    <tip>
      <para>The user can deal with several programs at once by holding
        <keycombo>
          <keycap>Ctrl</keycap>
          <mousebutton>Click</mousebutton>
        </keycombo> or 
        <keycombo>
          <keycap>Shift</keycap>
          <mousebutton>Click</mousebutton>
      </keycombo>.</para>
    </tip>

    <tip>
      <para>A program (or set of programs) that have been copied to
        the clipboard can be pasted on any Flow, and not just the Flow of
        origin. The user can simply switch to the <guilabel>Flows</guilabel> tab,
        select the target Flow, go back to the <guilabel>Flow
        Editor</guilabel> tab and paste the program(s).</para>
    </tip>

    <caution>
      <para>GêBR does <emphasis role="bold">not</emphasis> ask for
        confirmation before deleting programs from a
        Flow.</para>
    </caution>
  </section>

  <section xml:id="flow_editor_edit_parameters_program">
    <title>Editing program's parameters</title>
    <para>Program's parameters compose a set of initial configurations
    defined by the user.</para>
    <para>To edit program's parameters the user must follow the steps below:</para>
    <procedure>
      <step>
        <para>Select the program from the <guilabel>Flow
            sequence</guilabel> box and click on
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_editar_propriedades_projeto.png" />
              </imageobject>
            </inlinemediaobject>
          </guiicon> on the toolbar, or just double-click on the
          program. The <guilabel>Parameter</guilabel> dialog box will
          appear.</para>
      </step>
      <step>
        <para>Edit the program's parameters. Notice that each
          program's parameter vary greatly both in size and
          type.</para>
        <tip>
          <para>The user can click on the <guibutton>Help</guibutton> button
            (bottom left corner of the dialog box) to view
            the <emphasis role="bold">program's
              documentation</emphasis>. This will be certainly useful
            when the user is editing the programs parameters.</para>
        </tip>
        <tip>
          <para>The user can click on the <guibutton>Default</guibutton> button
            when he or she wants the program to return to its default
            configurations.</para>
        </tip>
      </step>
      <step>
        <para>When the user is done, he or she has to click on the <guibutton>OK</guibutton>
          button.</para>
      </step>
    </procedure>
  </section>

  <section xml:id="flow_editor_change_state_program">
    <title>Changing a program's state</title>
    <para>After the user has carried out process of
      <xref linkend="flow_editor_edit_parameters_program" />, the
      icon beside the program will change from 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_nao_configurado.png" />
          </imageobject>
        </inlinemediaobject>
			</guiicon> to
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_configurado.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon>. This means that the program's state passed 
      from <emphasis role="bold">Not configured</emphasis> to
      the <emphasis role="bold">Configured</emphasis> state. Besides
      these two states, the program can also be set to
      the <emphasis role="bold">Disabled</emphasis> state (<guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_desabilitado.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon>). The user can alternate between these states by using two
      methods:  <mousebutton>right-clicking</mousebutton>
      on the program and then select the desired state from the context menu 
      or using the shortcut
      <keycombo>
        <keycap>Spacebar</keycap>
    </keycombo> to change the state(s) of the selected programs.</para>

    <tip>
      <para>The user can select several programs whose state is desired to
        change by holding
        <keycombo>
          <keycap>Ctrl</keycap>
          <mousebutton>Click</mousebutton>
        </keycombo> or 
        <keycombo>
          <keycap>Shift</keycap>
          <mousebutton>Click</mousebutton>
      </keycombo>.</para>
    </tip>
    <tip>
      <para>Changing a program state does not alter its parameter
        configuration. The user can safely alternate between states.</para>
    </tip>
    <important>
      <para>
        <emphasis role="bold">Disabled</emphasis> programs (<guiicon>
          <inlinemediaobject>
            <imageobject>
              <imagedata fileref="../../common-images/icone_desabilitado.png" />
            </imageobject>
          </inlinemediaobject>
        </guiicon>) will be ignored when the Flow runs. This
        way, the user can <emphasis role="bold">enable and disable parts of
          the Flow</emphasis>.</para>
    </important>
  </section>

  <section xml:id="flow_editor_edit_input_output">
    <title>Editing the Flow's input and output files</title>
    <para>In many occasions, the user will need to extract data
      from an input file and/or generate as a result an output file,
      or even an log file in case an error occurs.</para>

    <para>To associate an input, output and error file to a Flow, the user must follow this steps:</para>
    <figure>
      <title>Input file setting</title>
      <mediaobject>
        <caption>Select the Flow Editor Tab. In the Flow sequence box
          the user can edit the input, output and log files for this Flow
          sequence.</caption>
        <imageobject>
          <imagedata fileref="../images/GeBR_flow_editor_input_file.png" />
        </imageobject>
      </mediaobject>
    </figure>
    <procedure>
      <step>
				<para>Select a Flow, in the <guilabel>Flow</guilabel> tab,
					and switch to the <guilabel>Flow Editor</guilabel> tab.</para>
      </step>
      <step>
					<para>
					In the Flow sequence box, the user can edit the input,
					output and log files paths by double clicking on them.
					</para>
      </step>
      <step>
        <para>Type in the path or click on the icon 
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/icone_escolher_arquivo.png" />
              </imageobject>
            </inlinemediaobject>
          </guiicon> to browse for the file (see
          <xref linkend="remote_browsing"/>).
        </para>
      </step>
    </procedure>

    <para>If the user wants to use the folders associated to the Line,
      he or she can either choose like above or the user can use the feature of
      autocomplete of the important folders of this Line.
    </para>
    <figure>
      <title>Autocomplete of paths</title>
      <mediaobject>
        <caption>
          Autocomplete feature in the Input file of a Flow.
        </caption>
        <imageobject>
          <imagedata fileref="../images/GeBR_flow_editor_autocomplete.png" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>When the user chooses a path for the 
      <guilabel>Flow's input/output</guilabel>, their file
      paths will appear in the
      <guilabel>Flow sequence</guilabel> box, indicated by the icons
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_arquivo_entrada.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon> and 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_arquivo_saida.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon>, below and above the Flow's programs (if there are
      any).</para>
    <note>
      <para>If the user wishes to <emphasis role="bold">remove a
          set</emphasis> from the list, select them by pressing
        <emphasis role="bold">right-click</emphasis> and then click on 
        <guimenuitem>Exclude</guimenuitem>.</para>
    </note>
  </section>


  <section xml:id="flow_editor_execute_flow">
    <title>Executing a Flow</title>
    <para>To execute the current Flow, the user has to click on 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_executar_fluxo.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon> or use the <guilabel>Flows</guilabel> tab
      (check <xref linkend="flows_browser_execute_flow"/>).</para>

    <para>In the Flow Editor Tab, the user can execute a
      Flow <emphasis>after</emphasis> another Flow, creating a queue of
      execution. To execute after a specific Flow, instead of
      executing <emphasis>"Immediately"</emphasis>, the user can switch to the Flow
      Editor Tab and choose the "After <emphasis>Flow
        A</emphasis>".</para>

    <para>By default, the Flows are executed on the Maestro group.
      More details about the definition and selection of servers and
      groups of servers can be found in
      <xref linkend="additional_features_maestro_servers_configuration"/>.</para>

    <para>In the <guilabel>Flow Editor</guilabel> tab, even if the user
      has selected several Flows from the <guilabel>Flows</guilabel>
      tab, when he/she clicks on
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_executar_fluxo.png" />
          </imageobject>
        </inlinemediaobject>
    </guiicon>, only the first of the selected Flows will be executed.</para>
    <figure>
      <title>Execution queue</title>
      <mediaobject>
        <caption>Screenshot of the <guilabel>Flow Editor</guilabel>
          tab. In the first menu of the <emphasis>Run</emphasis>, the user
          can choose after which flow it will be executed.
        </caption>
        <imageobject>
          <imagedata fileref="../images/GeBR_flow_editor_queue.png" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>
    The user can also set execution parameters, like performance and
    priority of execution (see sections <xref linkend="flow_editor_multicores"/> and 
    <xref linkend="flow_editor_priority_execution"/>).
    </para>

    <para>At the moment the Flow is executed, GêBR automatically
      switches to the <guilabel>Job Control</guilabel> tab and displays a
      report of the execution of the Flow .</para>
  </section>


  <section xml:id="flow_editor_loop">
    <title>Executing a Flow multiple times</title>
    <para>The
    program <emphasis>Loop</emphasis><indexterm><primary>Loop</primary></indexterm>
    (from the category
      <emphasis role="bold">Loops</emphasis>) has a totally different
      usage compared to the remaining programs from GêBR. The user is going
      to see some of these differences.</para>

    <para>When the user adds the program Loop, it always appears
      on the top of the Flow. That happens to indicate that the Flow
      is going to be executed more than once, according to the
      parameters set for the program. (see
      <xref linkend="flow_editor_edit_parameters_program" /> for
      further details).</para>

    <figure>
      <title>Loop program</title>
    <mediaobject>
      <caption>Screenshot of program <emphasis>Loop</emphasis>, added
      to a Flow and properly configured.</caption>
      <imageobject>
        <imagedata fileref="../images/GeBR_flow_editor_loop.png" />
      </imageobject>
    </mediaobject>
    </figure>

    <para>After the <emphasis>Loop</emphasis> is added, the user has
      access to a new variable,
      the <emphasis role="bold">iter</emphasis> (see
			<xref linkend="dictionary_variables" />). The value of this 
			special variable is modified
      on each iteration (increasing or decrementing),
      according to the parameters set.</para>

    <figure>
      <title>Loop parameters</title>
    <mediaobject>
      <caption>Screenshot of the edition from parameters
        of <emphasis>Loop</emphasis> program, with a simple example of
        parameters setting.</caption>
      <imageobject>
        <imagedata fileref="../images/GeBR_flow_editor_loop_parameters.png" />
      </imageobject>
    </mediaobject>
    </figure>

  </section>

  <section xml:id="flow_editor_multiple_machines">
    <title>Multiple machines</title>
    <para>If GêBR is connected to multiple machines through the
      <guilabel>Servers Configuration</guilabel> interface, and the
      selected Flow is
      parallelizable<indexterm><primary>Flow</primary><secondary>parallelizable</secondary></indexterm>
      (see below the criteria to be parallelizable), then you have the
      option to run it in a distributed way.</para>

    <para>To be considered parallelizable, besides having a loop, a
      Flow must achieve one of these criteria:</para>
    <itemizedlist>
      <listitem>
        <para>The Flow does not have an output file or, if it has one, the output has to depend on the variable iter;</para>
      </listitem>
      <listitem>
        <para>The output of each step of the loop is not the input of
          any other step of the loop.</para>
      </listitem>
    </itemizedlist>
    <para>In case the Flow is not parallelizable (i.e., does not fit
      one of the above conditions), GêBR will run the job in the best
      machine at the time of execution (GêBR rank them based mainly in
      availability and speed). In a distributed execution, it may be
      important to differentiate the Priority mode. When the Flow is
      parallelizable, it is splitted up and distributed between the
      available machines according to their ranking.</para>

    <para>If the user wants to run a Flow in a specific machine, then he
      can force the execution by going to <guilabel>Flow
      Editor</guilabel> tab, as choosing the working machine as shown
      below.</para>
  </section>
</chapter>
