<?xml version="1.0" encoding="utf-8"?>

<chapter
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  lang="en"
  version="5.0"
  xml:id="flows_tab">

  <title>The <guilabel>Flows</guilabel> tab</title>

  <para>In this tab, the user can manage the Flows of the current
    Line. Note the similarity with the <guilabel>Projects and
    Lines</guilabel> tab.</para>

  <tip>
    <para>Instead of the buttons in toolbar, try using
    the <emphasis role="bold">context menu</emphasis>. To do
    so, <emphasis role="bold">right-click</emphasis> on a Flow that has been 
    created. Notice that many features can be accessed through
    this method. For certain cases this is an easier and simpler
    choice.</para>
  </tip>

  <section xml:id="flows_browser_create_flow">
    <title>Creating Flows</title>

    <para>The third-level element of GêBR are processing flows or
      just <emphasis>Flows</emphasis> (see
      <xref linkend="concepts_elements" />).</para>

    <para>To create a Flow, follow the steps:</para>

    <procedure>
      <step><para>In the tab <guilabel>Projects and Lines</guilabel>,
          check that some Line is selected.</para>
      </step>
      <step><para>Go to <guilabel>Flows</guilabel> tab, then
      left-click on
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_criar_fluxo.png" />
              </imageobject>
            </inlinemediaobject>
        </guiicon>.</para>
      </step>
      <step>
        <para>A dialog box, named <guilabel>Flow "New Flow"
        Properties</guilabel>, will appear. Fill in the four standard fields:
          <guilabel>Title</guilabel>, <guilabel>Description</guilabel>
          (an one-line sentence), <guilabel>Author</guilabel> and
          an <guilabel>e-mail</guilabel> address. Click
          on <guibutton>OK</guibutton> when ready.</para>
      </step>
    </procedure>

    <para>After a Flow has been created, it will be 
      visible on the left side of the main window when the 
      <guilabel>Flows</guilabel> tab is selected. The 
      <guilabel>Details</guilabel> box, found on the right side of the
      main window, shows information about the selected Flow.
    </para>

    <tip>
      <para>The user can alter the position of the Flow in the list by
        dragging the Flow with the mouse to the desired
        position.</para>
    </tip>
    <tip>
      <para>Observe that the information bar just below the menu
        <guimenu>Actions</guimenu> shows the parents Line and Project
        of the selected Flow.</para>
    </tip>

    <important>
      <para>Performing the operations described above the user has
      just accomplished the creation of a Flow element in the
      interface. However, that new Flow still needs to be assembled,
      i.e., the user needs to select which programs will be
      chained to accomplish the purpose of the Flow. This further set
      up is describe in <xref linkend="flow_editor_create_flow" />.</para>
    </important>
  </section>

  <section xml:id="flows_browser_copy_paste_del_flows">

    <title>Coping, pasting and deleting Flows</title>

    <para>The clipboard provides the popular set of tools known as
      <emphasis>copy and paste</emphasis>. In GêBR, a Flow (or set of
      Flows) can be copied to the clipboard and paste back to the same
      Line or to other Lines. To copy Flows to the clipboard, first
      select them with the mouse, and then use the button
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_copiar_fluxo.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon> or press the usual shortcut
      <keycombo>
        <keycap>Ctrl</keycap>
        <keycap>C</keycap>
    </keycombo>. After copying a Flow (or a set of Flows) the user can paste it
      by clicking on the button
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_colar_fluxo.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon> or by simply using the shortcut 
      <keycombo>
        <keycap>Ctrl</keycap>
        <keycap>V</keycap>
    </keycombo>.</para>

    <para>To delete a Flow (or set of Flows), select them then click on 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_apagar_projeto.png" />
          </imageobject>
        </inlinemediaobject>
    </guiicon>.</para>

    <tip>
      <para>The user can handle several Flows at once by holding
        <keycombo>
          <keycap>Ctrl</keycap>
          <mousebutton>Left-click</mousebutton>
        </keycombo> or 
        <keycombo>
          <keycap>Shift</keycap>
          <mousebutton>Left-click</mousebutton>
      </keycombo>.</para>
    </tip>

    <tip>
      <para>Any Flow (or a set of Flows) that has been copied to the
      clipboard can be pasted to <emphasis>any Line</emphasis>. Simply
      switch to the
      <guilabel>Projects and Lines</guilabel> tab, select the desired
      Line, then go back to the <guilabel>Flows</guilabel> tab and
      paste the Flow(s).</para>
    </tip>
  

  </section>

  <section xml:id="flows_browser_edit_properties_flow">
    <title>Editing Flow's properties</title>
    <para>To edit Flow's properties the user must first select the Flow,
    then click on
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_editar_propriedades_projeto.png" />
          </imageobject>
        </inlinemediaobject>
    </guiicon>.</para>
    <para>In the <guilabel>Flows properties</guilabel> dialog box the user
    can edit the
    fields <guilabel>Title</guilabel>, <guilabel>Description</guilabel>, <guilabel>Author</guilabel>
    and <guilabel>Email</guilabel>.</para>
  </section>

  <section xml:id="flows_browser_edit_dictionary">
    <title>Editing the Flow's parameter dictionary</title>
    <para>This feature is documented in the section 
      <xref linkend="dictionary_variables" />.</para>
  </section>

  <section xml:id="flows_browser_save_state_flow">
    <title>Saving a Flow's state</title>
    <para>The user will find situations when working with GêBR it will be
      useful to use an existing Flow as a basis to create new
      Flows. For example, the user might want to experiment with Flows that
      are only slightly different from one another, however without
      having to discard or modify the original Flow.</para>

    <para>A way to do this is to copy and paste the Flow (see the
      section <xref linkend="flows_browser_copy_paste_del_flows" />.
      Another way is to save the state of the original Flow, then edit
      it to the heart desire, and when the user wishes, he or she can return the
      Flow to its original state. To
      <emphasis role="bold">save the Flow's state</emphasis>:</para>
    <procedure>
      <step>
        <para>Select the Flow and left-click on 
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_salvar_estado.png" />
              </imageobject>
            </inlinemediaobject>
        </guiicon>.</para>
      </step>
      <step>
        <para>If the user wants, he or she can write a comment on the state in the
        dialog box <guilabel>Save the Flow's state</guilabel>, as to
        identify this saved state later on.</para>
      </step>
      <step>
        <para>Left-click on 
          <guibutton>OK</guibutton>.</para>
      </step>
    </procedure>
    <note>
      <para>There is no limit on the number of states for each
      Flow.</para>
    </note>

    <para>To open the list of saved states left-click on 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_salvar_estado_lista.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon>, to the right of the button 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_salvar_estado.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon>, then select the state that is desired to recover. Whenever
     the user select a saved state from the list, the dialog
      <emphasis>Backup Current State</emphasis> will appear. If the user click on 
      <guibutton>Yes</guibutton> the dialog <emphasis>Save the Flow's
      State</emphasis> will appear, where the user can save this new
      state. If the user click on <guibutton>No</guibutton>, GêBR will
      simply revert to the chosen state without saving the current
      state.</para>
    <tip>
      <para>If the user is sure that he or she has saved the current state, GêBR
      recommends that the user click on <guibutton>No</guibutton>, in the
      dialog box <emphasis>Backup Current State</emphasis>, as to
      avoid a bloated state list.</para>
    </tip>
    <caution>
      <para>GêBR continuously saves the list of Flow states. Even if
      the user turns off the computer this list will be recovered when the user
      opens GêBR again. However, if the user <emphasis role="bold">deletes
      the Flow</emphasis> all the saved states
      will <emphasis role="bold">immediately disappear
      forever</emphasis>.</para>
    </caution>
  </section>

  <section xml:id="flows_browser_import_flow">
    <title>Importing/Exporting a Flow</title>
    <para>Although GêBR maintains all the data, the user still might wish
      to copy the Flows to file to be able to share them, for
      instance.</para>

        <para>In the window <guilabel>Save Flow</guilabel>, navigate
          to a desired directory and type a name for the file
          (GêBR will automatically determine the extension
          <filename class="exension">flw</filename>). To do so:</para>
    <procedure>
      <step>
        <para> In case of Import, the user must first 
          <emphasis role="bold">select a Flow</emphasis> (or see
          <xref linkend="projects_lines_create_projects" />, if one does not exist).</para>
      </step>
      <step>
        <para>Select the tab 
          <guilabel>Flows</guilabel> and left-click on 
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_importar_projeto.png" />
              </imageobject>
            </inlinemediaobject>
          </guiicon> to import or on 
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_exportar_projeto.png" />
              </imageobject>
            </inlinemediaobject>
          </guiicon> to export.
        </para>
      </step>
      <step>
        <para>Navigate through the files and
          select the Flow that is desired to be
          imported/export.</para>
      </step>
    </procedure>
    <para>In case of Import, the imported Flow will be
      listed along with any other Flows of the
      selected Line. Otherwise, in case of Export,
      the file containing the exported Flow will be
      created.</para>
  </section>


	<section xml:id="flows_browser_execute_flow">
		<title>Flow execution</title>

		Once assembled a Flow, it can be executed.
		

		<figure>
			<title>Flows tab</title>
			<mediaobject>
				<caption>The user can execute many Flows at once.
				</caption>
				<imageobject>
					<imagedata fileref="../images/GeBR_flow_browser.png"  contentwidth="604px" contentdepth="379px" />
				</imageobject>
			</mediaobject>
		</figure>

		<para>In GêBR, the user can select more than one Flow, and then execute them all. To make a
			multiple selection, click over the Flows, while <keycap>Ctrl</keycap> is pressed or use
			the arrow keys while <keycap>Shift</keycap> is pressed.
			The set of Flows can be executed sequentially by clicking on the icon
					<guiicon>
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="../../common-images/botao_executar_fluxo.png" />
							</imageobject>
						</inlinemediaobject>
					</guiicon>.
		</para>

			<important>
				<para>When executig many Flows, the configurations of
					the first flow on the list will determine the
					others.
				</para>
			</important>

			<para>
				The Flows can be executed in two ways:
				<itemizedlist>
					<listitem>
						Advanced (
						<guiicon>
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="../../common-images/detailed_execution.png" />
								</imageobject>
							</inlinemediaobject>
						</guiicon>). 
					</listitem>
					<listitem>
						Basic (
						<guiicon>
							<inlinemediaobject>
								<imageobject>
									<imagedata fileref="../../common-images/botao_executar_fluxo.png" />
								</imageobject>
							</inlinemediaobject>
						</guiicon>). 
					</listitem>
				</itemizedlist>
			</para>

			<section xml:id="flows_browser_detailed_execution">
				<title>Detailed Execution</title>
				<para>
					The user can set many execution details before triggering a Job and then he or she just have to
					click on Run to execute the Job. 
				</para>
				<figure>
					<title>Detailed execution</title>
					<mediaobject>
						<caption>Execution settings window.
						</caption>
						<imageobject>
							<imagedata fileref="../images/GeBR_flows_detailed_execution_multiple.png"  contentwidth="309px" contentdepth="397px" />
						</imageobject>
					</mediaobject>
				</figure>
				<para>
					By clicking over 
					<guiicon>
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="../../common-images/detailed_execution.png" />
							</imageobject>
						</inlinemediaobject>
					</guiicon>, the user can set:

					<procedure>
						<step>
							Whether he wants to queue its Jobs or not. This option just appear if the user selects
							multiple Jobs for running (multiple execution). Flows can be executed one after another, in
							the order they are on the Flows list.
							Each Flow waits for the end of the previous job, to be
							executed. During this time, the waiting Flow shows an icon
							of "Waiting for job". If the user wishes to execute the set of Flows in a specific
							order, he or she just has to reorder the Flows by Drag and Drop. In the second option
							Flows are executed parallely, all of them at the same time. It is just possible if
							there is no dependency between Flows.
						</step>
						<step>
							Whether the Jobs must wait for some task or not. The user can trigger the Jobs after
							the ending of another task or immediately after clicking the execution button. For more information, consult
							<xref linkend="flow_editor_execute_flow"/>.
						</step>
						<step>
							Where he wants to dispatch the Jobs. The user can choose the nodes or the set of nodes which he wants to
							process the Jobs. A special option is the Choose automatically, that
							permits the Maestro to search for the least loaded nodes or set of nodes. As the user changes this parameter,
							GêBR presents the number of cores of the choosen group. For more information, consult
							<xref linkend="flow_editor_execute_flow"/>.
						</step>
						<step>
							The number of parts the user wants to split the Jobs. This parameter is valid just in the case
							there is a parallelizable Job among the selected Jobs. The nominal capacity is given by
							the number of cores, according to the choice of the group of nodes. For
							non-parallelizable Jobs, this parameter is automatically set to 1. For more
							information, consult <xref linkend="flow_editor_multicores"/>.
						</step>
						<step>
							How the Job must compete with the other processes of the system. In very loaded nodes,
							this tool can make all the difference because the Jobs will have less precedence than the
							other processes running on the system. For more
							information, consult <xref linkend="flow_editor_priority_execution"/>.
						</step>
					</procedure>
				</para>

				<note>
					The user can save itens 3, 4 and 5 for future executions by checking <guilabel>Save Preferences</guilabel>.
				</note>
			</section>

			<section xml:id="flows_browser_quick_execution">
				<title>Quick execution</title>
				<para>
					By clicking on 
					<guiicon>
						<inlinemediaobject>
							<imageobject>
								<imagedata fileref="../../common-images/botao_executar_fluxo.png" />
							</imageobject>
						</inlinemediaobject>
					</guiicon> 
					, the Job will be triggered with the following settings:

					<procedure>
						<step>
							Sequentially
						</step>
						<step>
							Immediatelly
						</step>
						<step>
							Saved group of nodes
						</step>
						<step>
							Saved number of parts (if applicable)
						</step>
						<step>
							Saved priority
						</step>
					</procedure>
				</para>
				<para>
					It is a fast way to execute, skipping the configurations of the Detailed Execution.
				</para>
				<note>
					Useful keybinds are available here: <keycap>Ctrl+R</keycap> runs the selected Flows
					one after another; <keycap>Ctrl+Shift+R</keycap> runs the
					selected Flows parallely (keybind activated just if multiple Flows are selected).
				</note>
			</section>

		</section>

		<section xml:id="flows_browser_speed_execution">
			<title>Execution speed</title>
			<para>The Flow's execution speed is determined by the number of
				processors and priority of execution. It's possible to configure
				these parameters, as detailed in
				<xref linkend="flow_editor_multicores"/> and
				<xref linkend="flow_editor_priority_execution"/>.
			</para>
		</section>


		<section xml:id="flows_browser_edit_comments_flow">
    <title>Editing comments</title>
    <para>This button appears in the <guilabel>Projects and
    Lines</guilabel> tab and in <guilabel>Flows</guilabel> tab. This
    button allows the user to add
    comments<indexterm><primary>Report</primary><secondary>of a
    Flow</secondary></indexterm> about the selected Line or Flow. See
    <xref linkend="projects_lines_edit_comments_project" />.</para>
  </section>

  <section xml:id="flows_browser_view_report_flow">
    <title>View Report</title>
    <para>This button appears in the <guilabel>Projects and
    Lines</guilabel> tab and in <guilabel>Flows</guilabel> tab. This
    button allows the user to View the Report about the Line or Flow
    in use. The difference is that the Line's Report can include the
    Flow's Report.  All other functions are described in
    <xref linkend="projects_lines_view_report_project" />.</para>
  </section>
</chapter>
