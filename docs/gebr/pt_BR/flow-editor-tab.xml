<?xml version="1.0" encoding="utf-8" ?>

<section
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  lang="pt_BR"
  version="5.0"
  xml:id="sec_3_3">

  <title>A aba <guilabel>Editor de Fluxo</guilabel></title>

  <para>
    Para criar um Fluxo, você pode seguir as instruções da seção
    <xref linkend="creating_flows" />
  </para>

  <para>
    Agora que já sabemos como adicionar programas em um Fluxo, vamos aprender
    como configurar esses programas e investigar outras ferramentas que podem
    ser encontradas na aba <guilabel>Editor de Fluxo</guilabel>:
  </para>

  <itemizedlist>
    <listitem>
      <para>
        <link linkend="copiar_programa_para_area_de_transferencia">Copiar Programas selecionados para a área de transferência</link>
      </para>
    </listitem>
    <listitem>
      <para>
        <link linkend="sec_3_3_2">Colar Programas da área de transferência</link>
      </para>
    </listitem>
    <listitem>
      <para>
        <link linkend="sec_3_3_3">Deletar Programa</link>
      </para>
    </listitem>
    <listitem>
      <para>
        <link linkend="editar_parametros_programa">Editar parâmetros do Programa</link>
      </para>
    </listitem>
    <listitem>
      <para>
        <link linkend="sec_3_3_5">Change a program's state</link>
      </para>
    </listitem>
    <listitem>
      <para>
        <link linkend="editar_arquivos_entrada_saida_fluxo">Editar a entrada e saída do Fluxo</link>
      </para>
    </listitem>
    <listitem>
      <para>
        <link linkend="executar_fluxo">Executar Fluxo</link>
      </para>
    </listitem>
  </itemizedlist>

  <tip>
    <para>
      Alguns comandos estão na barra de ferramentas, enquanto outros estão no
      menu de contexto, que é acionado ao clicar com o botão direito nos
      programas da lista.
    </para>
    <para>
      Os arquivos de entrada e saída são definidos na própria lista de
      programas.
    </para>
  </tip>

  <section xml:id="copiar_programa_para_area_de_transferencia">
    <title>Copiando programas para a área de transferência</title>
    <para>
      Da mesma forma que se faz com fluxos (veja a
      <xref linkend="copiar_fluxos_area_tranferencia"/>), um programa (ou um
      conjunto de programas) pode ser copiado para a área de transferência por
      meio do botão
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_copiar_fluxo.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon> ou, pela tecla de atalho
      <keycombo>
        <keycap>Ctrl</keycap>
        <keycap>C</keycap>
      </keycombo>.
    </para>
    <tip>
      <para>
        Você pode selecionar vários programas para serem copiados
        simultaneamente usando 
        <keycombo>
          <keycap>Ctrl</keycap>
          <mousebutton>Clique</mousebutton>
        </keycombo> ou 
        <keycombo>
          <keycap>Shift</keycap>
          <mousebutton>Clique</mousebutton>
        </keycombo>.
      </para>
    </tip>
  </section>

  <section xml:id="sec_3_3_2">
    <title>Colar programas da área de transferência</title>
    <para>
      Depois de ter sido selecionado e copiado
      <xref linkend="copiar_programa_para_area_de_transferencia"/>,
      um programa (ou um conjunto de programas) pode ser colado por meio do
      botão
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_colar_fluxo.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon>
      ou, pela tecla de atalho
      <keycombo>
        <keycap>Ctrl</keycap>
        <keycap>V</keycap>
      </keycombo>.
    </para>
    <tip>
      <para>
        O programa (ou conjunto de programas) copiado anteriormente para a área
        de transferência pode ser colado em <emphasis>qualquer fluxo</emphasis>
        existente, e não só no fluxo de origem. Basta alternar para a aba
        <guilabel>Fluxos</guilabel>, selecionar o fluxo desejado, voltar para a
        aba <guilabel>Editor de Fluxo</guilabel> e colar o(s) programas(s).
      </para>
    </tip>
  </section>

  <section xml:id="sec_3_3_3">
    <title>Deletar programas</title>
    <para>
      Para excluir um programa (ou um conjunto de programas), selecione-o e
      clique no botão
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_apagar_projeto.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon>.
    </para>
    <tip>
      <para>
        Você pode selecionar vários programas para serem excluidos
        simultaneamente usando 
        <keycombo>
          <keycap>Ctrl</keycap>
          <mousebutton>Clique</mousebutton>
        </keycombo> ou 
        <keycombo>
          <keycap>Shift</keycap>
          <mousebutton>Clique</mousebutton>
        </keycombo>.
      </para>
    </tip>
    <caution>
      <para>A GêBR <emphasis>não emite aviso</emphasis> antes de deletar
        programas.</para>
    </caution>
  </section>

  <section xml:id="editar_parametros_programa">
    <title>Editar os parâmetros de um programa</title>
    <para>Para editar os parâmetros de um programa:</para>
    <procedure>
      <step>
        <para>
          Selecione-o na caixa <guilabel>Sequência de fluxo</guilabel> e clique
          no botão
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/botao_editar_propriedades_projeto.png"/>
              </imageobject>
            </inlinemediaobject>
          </guiicon>, ou dê um clique duplo no programa.
        </para>
      </step>
      <step>
        <para>Na janela <guilabel>Parâmetros</guilabel>, edite os parâmetros do programa. Note que os parâmetros
          variam bastante de um programa para outro, tanto em quantidade como em tipo.</para>
        <tip>
          <para>Clique no botão <guibutton>Ajuda</guibutton> (canto inferior esquerdo da janela
            <guilabel>Parâmetros</guilabel>) para visualizar a <emphasis role="bold">documentação do
              programa</emphasis>. Isso pode ser útil durante a edição de parâmetros.</para>
        </tip>
        <tip>
          <para>Clique no botão <guibutton>Padrão</guibutton> quando quiser retornar para a configuração padrão do
            programa.</para>
        </tip>
      </step>
      <step>
        <para>Clique em <guibutton>OK</guibutton>.</para>
      </step>
    </procedure>
  </section>

  <section xml:id="sec_3_3_5">
    <title>Mudar o estado de um programa</title>
    <para>
      Após realizar o procedimento da
      <xref linkend="editar_parametros_programa"/>, note que o programa passa a
      ser sinalizado por
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_configurado.png"/></imageobject>
        </inlinemediaobject>
      </guiicon> em vez de
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_nao_configurado.png"/></imageobject>
        </inlinemediaobject>
      </guiicon>. Isso indica que o programa passou do estado
      <emphasis>Não configurado</emphasis> para o estado
      <emphasis>Configurado</emphasis>. Além desses dois estados, um programa
      pode assumir ainda o estado <emphasis role="bold">Desabilitado</emphasis> (
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata
              fileref="../../common-images/icone_desabilitado.png"/></imageobject>
        </inlinemediaobject>
      </guiicon>).
      Você pode alternar entre estes estados de duas maneiras,
      <mousebutton>clique com botão direito</mousebutton> sobre o programa e
      selecione o estado desejado a partir do menu de contexto ou use o atalho
      <keycombo><keycap>Espaço</keycap></keycombo> para trocar entre os
      possíveis estados dos programas selecionados.
    </para>
    <tip>
      <para>
        Você pode mudar o estado de vários programas simultaneamente,
        selecionando-os com
        <keycombo>
          <keycap>Ctrl</keycap>
          <mousebutton>Clique</mousebutton>
        </keycombo> ou
        <keycombo>
          <keycap>Shift</keycap>
          <mousebutton>Clique</mousebutton>
        </keycombo>.
      </para>
    </tip>
    <tip>
      <para>
        Mudar o estado do programa não altera a configuração dos parâmetros.
        Você pode alternar com segurança entre os estados, os parâmetros serão
        preservados.
      </para>
    </tip>
    <important>
      <para>
        Programas <emphasis>Desabilitados</emphasis> (
        <guiicon>
          <inlinemediaobject>
            <imageobject>
              <imagedata fileref="../../common-images/icone_desabilitado.png"/>
            </imageobject>
          </inlinemediaobject>
        </guiicon>) são ignorados durante a execução do fluxo. Dessa forma,
        você pode <emphasis>habilitar ou desabilitar pedaços de um fluxo</emphasis>, conforme a
        conveniência.
      </para>
    </important>
  </section>

  <section xml:id="editar_arquivos_entrada_saida_fluxo">
    <title>Editar arquivos de entrada e saída do fluxo</title>
    <para>
      No exemplo da <xref linkend="criando_fluxos"/> criamos um fluxo muito
      simples, que não precisava "ler" nenhum arquivo, e que gerava como
      resultado uma saída de tela. Porém, há situações em que o fluxo precisa
      extrair dados de um arquivo de entrada e gerar como resultado um arquivo
      de saída ou de erro, caso ocorra algum problema durante a execução.
    </para>

    <para>Para associar arquivos de entrada, saída e erro a um fluxo:</para>

    <figure>
      <mediaobject>
        <caption>Na aba Editor de Fluxo, no campo Sequência de fluxo, edita-se os arquivos de entrada, saída e log para esta
          sequência de Fluxo.</caption>
        <imageobject>
          <imagedata fileref="../images/GeBR_flow_editor_input_file.png"/>
        </imageobject>
      </mediaobject>
    </figure>
    <procedure>
      <step>
        <para>
          Certifique-se de ter selecionado o fluxo e, na aba Editor de
          Fluxo, no campo Sequência de fluxo, pode-se editar os caminhos de
          entrada, saída e erro através de um clique duplo nos botões. Ver
          figura: 
        </para>
      </step>
      <step>
        <para>
          Edite os caminhos ou clique no ícone
          <guiicon>
            <inlinemediaobject>
              <imageobject>
                <imagedata fileref="../../common-images/icone_escolher_arquivo.png"/>
              </imageobject>
            </inlinemediaobject>
          </guiicon>
          e navegue pela janela <guilabel>Escolha um arquivo</guilabel>.
        </para>
      </step>
    </procedure>
    <para>
      Ao sair da janela <guilabel>Entrada/Saída do fluxo</guilabel>, note que
      os arquivos de entrada e saída que você associou ao fluxo aparecem na
      caixa <guilabel>Sequência de fluxo</guilabel>, sinalizados com os ícones
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_arquivo_entrada.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon> e
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/icone_arquivo_saida.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon>, abaixo e acima dos programas do fluxo (se houver algum).
    </para>
    <note>
      <para>Se quiser <emphasis role="bold">remover um conjunto</emphasis> da lista, selecione-o com
        o <emphasis role="bold">botão direito</emphasis> do mouse e clique em
        <guimenuitem>Excluir</guimenuitem>.</para>
    </note>
  </section>

  <section xml:id="executar_fluxo">
    <title>Executar um fluxo</title>
    <para>
      Para executar o fluxo atual, clique no botão 
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_executar_fluxo.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon>.
    </para>


    <para>
      Na aba Editor de Fluxo, você pode executar um Fluxo após outro Fluxo
      terminar. Assim você pode criar filas de execução.
    </para>
    <para>
      Para executar após outro fluxo, mude para a aba Editor de Fluxo e
      escolha-o na lista <emphasis>Imediatamente</emphasis>.
    </para>

    <para>
      Por padrão os fluxos são executados no grupo do maestro. Mais detalhes
      podem ser vistos na seção <xref linkend="servers_configuration" />.
    </para>

    <para>
      Na aba Editor de Fluxo, ainda que se tenha selecionado vários fluxos na
      aba Fluxos, ao se clicar no botão
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../../common-images/botao_executar_fluxo.png"/>
          </imageobject>
        </inlinemediaobject>
      </guiicon> será executado apenas o primeiro fluxo selecionado.
    </para>

    <figure>
      <mediaobject>
        <caption>Aba Editor de Fluxo. O primeiro menu na área <emphasis>executar</emphasis>
          determina após qual fluxo executar o fluxo atual.</caption>
        <imageobject>
          <imagedata fileref="../images/GeBR_flow_editor_queue.png" />
        </imageobject>
      </mediaobject>
    </figure>
    <para>No momento em que um Fluxo é executado, a GêBR troca para a aba de
      <guilabel>Controle de Tarefas automaticamente</guilabel>, local onde
      informações sobre a execução podem ser consultadas.</para>
  </section>

  <section xml:id="multi_cores">
    <title>Múltiplos processadores</title>
    <para>A GêBR otimiza a execução de laços em máquinas com
      múltiplos-processadores. Se o Fluxo possui um laço e é paralelizável
      (dado o critério, mostrado abaixo), então você pode ajustar a performance
      da execução baseado número de processadores que a máquina possui.</para>
    <para>Para ser considerado paralelizável, além de possuir um laço, o Fluxo
      precisa atender a um, e apenas um dos critérios listados abaixo:</para>

    <itemizedlist>
      <listitem>não ter arquivo de saída;</listitem>
      <listitem>não deve existir uma saída que é uma entrada.</listitem>
    </itemizedlist>

    <para>
      Você pode escolher a porcentagem de processadores a serem usados através
      da barra que é exibida ao clicarmos no botão
      <guiicon>
        <inlinemediaobject>
          <imageobject>
            <imagedata fileref="../images/GeBR_flow_editor_flow_exec_speed.png" />
          </imageobject>
        </inlinemediaobject>
      </guiicon>.
    </para>
    <para>
      Cada nível de ajuste da barra corresponde a um número de processadores a
      serem usados. No seu valor mínimo, apenas um processador será usado, ao
      passo que no valor máximo, todos os processadores disponíveis serão
      usados.
    </para>
  </section>

  <section xml:id="priority_execution">
    <title>Prioridade de execução</title>
    <para>
      Atualmente os computadores são capazes de executar múltiplas tarefas ao
      mesmo tempo. Quando muitas tarefas são executadas ao mesmo tempo, o
      computador pode ficar sobrecarregado e perder performance. Processamento
      sísmico, particularmente, pode exaurir os recursos computacionais
      rapidamente.</para>

    <para>
      A GêBR pode amenizar este efeito dando <emphasis>baixa prioridade</emphasis>
      à execução do seu Fluxo:</para>

    <imageobject>
      <imagedata fileref="../images/GeBR_flow_editor_priority_execution.png" />
    </imageobject>

    <para>Duas opções estão disponíveis:</para>

    <!-- TODO: Traduzir daqui para baixo! -->

    <itemizedlist>
      <listitem>Low priority (the Flow is going to wait its turn to execute and try not to
        overload the system)</listitem>
      <listitem>High priority (the execution of the Flow is going to dispute for the computer
        resources with the other active programs)</listitem>
    </itemizedlist>
    <para>If the user leaves the button <emphasis>unpressed</emphasis>, then the next execution of a Flow is going to
      be done in a polite way. Otherwise, in case the button is left pressed, then the next
      execution is going to fight for the computer resources.</para>
    <para>Technically, when running in "Low Priority" mode, GêBR will reduce the run priority of the
      task, meaning it will tell the computer that "it can wait more important things to be done".
      This is the case when you have other things to do while you wait your calculations to be done.
      The "High Priority" mode means GêBR will use greater run priority for the task, and that implies
      it will act as a foreground process, demanding more resources. It's the "I need this done"
      mode, when you need the job to be finished as soon as possible, and you don't care if it will
      fight for resources with other programs.</para>
    <para>If GêBR is the only program executing on your machine, i.e., it doesn't have a
      challenger for the computer resources, then both states corresponds to the same situation.
      This is the "nightly job" situation, when (theoretically) no one is using the machines and
      some jobs are left to be done for the next morning.</para>
  </section>
  <section xml:id="loop">
    <title>Executing a Flow multiple times</title>
    <para>The program 
      <emphasis>Loop</emphasis>(from the category 
      <emphasis role="bold">Loops</emphasis>) has a totally different usage compared to the
      remaining programs from GêBR. We are going to see some of these differences.</para>
    <para>When we add the program Loop, we can see it always appears in the top of the Flow. That
      happens to indicate that the Flow is going to be executed more than once, according to the
      parameters set for the program. (see 
      <xref linkend="editar_parametros_programa" />for further details).</para>
    <mediaobject>
      <caption>Screenshot of program 
        <emphasis>Loop</emphasis>, added to a Flow and properly configured.</caption>
      <imageobject>
        <imagedata fileref="../images/GeBR_flow_editor_loop.png" />
      </imageobject>
    </mediaobject>
    <para>After the 
      <emphasis>Loop</emphasis>is added, the user has access to a new variable, the 
      <emphasis role="bold">iter</emphasis>. This special variable changes its value on each
      iteration, according to the parameters set.</para>
    <mediaobject>
      <caption>Screenshot of the edition from parameters of 
        <emphasis>Loop</emphasis>program , with a simple example of parameters setting.</caption>
      <imageobject>
        <imagedata fileref="../images/loop_parametros.png" />
      </imageobject>
    </mediaobject>
    <tip>Further information about the variable 
      <emphasis role="bold">iter</emphasis>are available in section 
      <xref linkend="variavel_iter" />.</tip>
  </section>
  <section xml:id="multiple_machines">
    <title>Multiple machines</title>
      <para>If GêBR is connected to multiple machines through the Servers Configuration
      interface, and the selected Flow is parallelizable (see below the criteria to be
      parallelizable), then the option Auto-choose mean that GêBR is going to run it in a
      distributed way.</para>
    <para>To be considered parallelizable, besides having a loop, a Flow must achieve one
      of these criteria:</para>
    <itemizedlist>
      <listitem>
        <para>The Flow does not have an output file;</para>
      </listitem>
      <listitem>
        <para>The output of each step of the loop is not the input of any other step of the
          loop.</para>
      </listitem>
    </itemizedlist>
    <para>In case the Flow is not parallelizable (i.e., does not fit one of the above conditions),
      GêBR will run the job in the best machine 
      at the time of execution (GêBR rank them based mainly in availability and speed). In a distributed
      execution, it may be important to differentiate the Priority mode. When the Flow is
      parallelizable, it is the split up and distributed between the available machines according
      to their ranking.</para>
    <para>If the user wants to run a Flow in a specified machine, then he can force the execution
      by going to Flow Editor tab, as choosing the machine of execution as shown
      below.</para>
  </section>

</section>
